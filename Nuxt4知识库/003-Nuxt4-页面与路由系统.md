# Nuxt4 页面与路由系统（Pages & Routing）
标签: Nuxt4, 路由, 页面, vue-router

## 问题描述
在传统的 Vue 应用中，管理路由（Routing）通常需要手动配置一个 `router.js` 文件，这既繁琐又容易出错。Nuxt4 如何简化这一过程，并提供更强大的功能，如动态路由、嵌套路由和自定义路由元信息？

## 解决方案
Nuxt4 的核心特性之一是**基于文件的路由系统**。你无需编写任何路由配置文件，Nuxt 会自动扫描 `pages/` 目录下的文件结构，并生成对应的 [vue-router](https://router.vuejs.org/) 配置。

### 基础路由
- 在 `pages/` 目录下创建一个 `.vue` 文件，路由就会自动被创建。
- `pages/index.vue` -> `/`
- `pages/about.vue` -> `/about`
- `pages/user/profile.vue` -> `/user/profile`

### 动态路由
- 如果你需要一个根据参数变化的路由（例如，根据用户 ID 显示不同的页面），可以使用方括号 `[]` 来创建一个动态路由。
- `pages/users/[id].vue` -> `/users/:id` (例如 `/users/123`)
- 在组件内部，可以通过 `$route.params.id` 来获取参数。

#### 动态路由参数校验
你甚至可以为动态路由参数添加校验规则，如果校验失败，Nuxt 会自动返回 404 页面。
- `pages/users/[id].vue`:
```vue
<script setup>
const route = useRoute();

// 校验 id 是否为数字
definePageMeta({
  validate: (route) => {
    return /^[0-9]+$/.test(route.params.id);
  },
});

// 你的页面逻辑...
</script>
```

### 嵌套路由
- 要创建嵌套路由（例如，在用户中心页面中显示子页面），你需要一个父组件和子路由的渲染出口 `<NuxtPage />`。
- 创建 `pages/parent.vue` 和 `pages/parent/child.vue`。
- `pages/parent.vue`:
```vue
<template>
  <div>
    <h1>我是父页面</h1>
    <!-- 子页面会在这里渲染 -->
    <NuxtPage />
  </div>
</template>
```
- 访问 `/parent/child` 时，`child.vue` 的内容会渲染在 `parent.vue` 的 `<NuxtPage />` 组件中。

### 导航
- 使用 `<NuxtLink>` 组件进行页面间的导航。它类似于 HTML 的 `<a>` 标签，但为 Nuxt 路由做了特别优化，可以预加载页面，提升性能。
```vue
<template>
  <nav>
    <NuxtLink to="/">首页</NuxtLink>
    <NuxtLink to="/about">关于我们</NuxtLink>
    <NuxtLink to="/users/123">用户 123</NuxtLink>
  </nav>
</template>
```

### 自定义页面元信息 (`definePageMeta`)
- 你可以使用 `definePageMeta` 宏在页面组件中定义路由的元信息，例如布局、中间件、过渡效果等。
- `pages/special.vue`:
```vue
<script setup>
definePageMeta({
  layout: 'custom', // 为此页面指定一个自定义布局
  middleware: ['auth'], // 为此页面添加路由守卫
  pageTransition: { name: 'fade', mode: 'out-in' } // 定义页面过渡动画
});
</script>
```

## 示例代码
一个包含动态路由参数的页面组件 `pages/users/[id].vue`：
```vue
<template>
  <div>
    <h1>用户中心</h1>
    <p>正在查看用户 ID: {{ $route.params.id }}</p>
    <p>通过组合式函数获取: {{ userId }}</p>
  </div>
</template>

<script setup>
const route = useRoute();
const userId = computed(() => route.params.id);

// 你可以在这里使用 userId 来获取用户数据
const { data: user } = await useFetch(`/api/users/${userId.value}`);

// 设置页面的 <title>
useHead({
  title: `用户 ${userId.value} 的个人主页`,
});
</script>
```

## 常见坑点与注意事项
- **`<a>` vs `<NuxtLink>`**: 在 Nuxt 应用内部导航时，**始终**使用 `<NuxtLink>`。直接使用 `<a>` 标签会导致整个页面重新加载，丢失 SPA 的优势。
- **动态路由文件夹**: 如果你的动态路由下还有子路由，例如 `/users/[id]/settings`，你需要将动态文件命名为 `pages/users/[id].vue`，并创建一个同名的文件夹 `pages/users/[id]/` 来存放子路由文件，如 `settings.vue`。
- **刷新页面与 `$route`**: 在 `setup` 脚本中直接访问 `$route.params` 可能不是响应式的。推荐使用 `useRoute()` 组合式函数来获取当前的路由对象。
- **路由生成**: 如果你对自动生成的路由感到好奇，可以在开发时访问 `/_nuxt/routes.json` (一个假设的调试路径，具体以 Nuxt 版本为准) 来查看 Nuxt 为你生成的路由配置。

## 参考链接
- [Nuxt4 官方文档 - 页面与路由](https://nuxt.com/docs/getting-started/routing)
- [Nuxt4 官方文档 - `<NuxtLink>` 组件](https://nuxt.com/docs/api/components/nuxt-link)
- [Nuxt4 官方文档 - `definePageMeta` 宏](https://nuxt.com/docs/api/macros/define-page-meta)