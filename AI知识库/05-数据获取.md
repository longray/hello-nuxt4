# Nuxt4 数据获取：从宇宙厨房点餐

在构建任何一个动态网站时，从外部世界（通常是 API）获取数据都是必不可少的核心环节。Nuxt4 为此提供了几件神兵利器，让数据获取变得既优雅又强大。其中最常用的两位大将就是 `useFetch` 和 `useAsyncData`。

## `useFetch`：你的专属外卖小哥

*   **比喻：** 你可以把 `useFetch` 想象成一个极其智能、服务周到的“外卖小哥”。你只需要告诉他你想吃什么（API 端点），他就会自动帮你下单、取餐（发送请求、获取数据），并把热腾腾的饭菜（数据）送到你手上。更妙的是，他还会帮你处理各种意外情况，比如餐厅关门了（请求失败）、路上堵车（加载状态）等等。

*   **工作原理：** `useFetch` 是对 `useAsyncData` 和 `$fetch` 的一个便捷封装。它专门用于处理针对特定 URL 的数据请求，代码写起来非常简洁。

*   **实战演练：**

    ```vue
    <script setup>
    // 假设我们要从一个 API 获取文章列表
    const { data: posts, pending, error, refresh } = await useFetch('https://api.example.com/posts')
    </script>

    <template>
      <div v-if="pending">正在加载文章...</div>
      <div v-else-if="error">加载失败：{{ error.message }}</div>
      <ul v-else>
        <li v-for="post in posts" :key="post.id">{{ post.title }}</li>
      </ul>
      <button @click="refresh">刷新列表</button>
    </template>
    ```

    看到了吗？`useFetch` 一次性返回了你需要的所有东西：
    *   `data`: 成功获取到的数据。
    *   `pending`: 一个布尔值，表示请求是否还在进行中。
    *   `error`: 如果请求失败，这里会包含错误信息。
    *   `refresh`: 一个函数，可以让你手动重新发起这个请求。

## `useAsyncData`：你的万能料理机

*   **比喻：** 如果说 `useFetch` 是外卖小哥，那 `useAsyncData` 就是一台“万能料理机”。它不关心食材（数据）从哪里来，你可以从 API 获取，可以直接计算，甚至可以从本地数据库读取。你只需要提供一个能够返回 Promise 的“食谱”（异步函数），它就能帮你烹饪出美味大餐。

*   **工作原理：** `useAsyncData` 接受一个唯一的键（key）和一个异步函数。它会执行这个函数，并将结果缓存起来，避免在服务端和客户端之间重复获取相同的数据。

*   **实战演练：**

    ```vue
    <script setup>
    // 使用 useAsyncData 来获取文章，这里我们可以用 $fetch 这个内置工具
    const { data: posts, pending, error } = await useAsyncData(
      'posts-list', // 这是唯一的 key，用于缓存
      () => $fetch('https://api.example.com/posts')
    )
    </script>
    ```

    **什么时候用 `useAsyncData`？**
    当你的数据获取逻辑比一个简单的 GET 请求更复杂时，比如需要依赖其他响应式数据，或者需要进行一些数据转换时，`useAsyncData` 就派上用场了。

## `$fetch`：你的“轻功”高手

*   **比喻：** `$fetch` 就像是一位“轻功”高手，来无影去无踪。它是一个纯粹的 HTTP 请求工具，可以在任何地方使用（组件、API 路由、插件等），但它本身不处理像 `pending` 或 `error` 这样的状态。它只负责把数据给你取回来。

*   **特点：**
    *   **同构 (Isomorphic)：** 在服务端和客户端都能用。
    *   **自动解析 JSON：** 无需手动 `JSON.parse()`。
    *   **智能处理 API 前缀：** 能自动识别和处理在 `nuxt.config.ts` 中配置的 `baseURL`。

---

总结一下：

*   **日常 API 请求**，特别是 GET 请求，用 `useFetch` 就对了，省心省力。
*   **有复杂逻辑的异步操作**，或者需要更精细的缓存控制时，请出 `useAsyncData` 这位大师。
*   **在非组件环境（如 server/api）** 或者只是想简单发个请求而不需要附带的加载状态时，就让 `$fetch` 大显身手吧。

掌握了这三门绝技，你就打通了 Nuxt4 应用的“任督二脉”，可以自由地与外部世界进行数据交互了！