# ğŸ§  æ™ºèƒ½ä½“è®°å¿†æ ¸å¿ƒäº¤äº’è§„èŒƒ (v2.0)

**ç‰ˆæœ¬**: 2.0
**æœ€åæ›´æ–°**: 2024-08-01
**æ ¸å¿ƒå˜æ›´**: æ•°æ®åº“æ¶æ„ä»â€œæ··åˆå­˜å‚¨â€å‡çº§ä¸ºâ€œå¤šé›†åˆç‹¬ç«‹å®ä½“â€æ¨¡å‹ã€‚

---

## **ç¬¬ä¸€ç« ï¼šæ ¸å¿ƒè®¾è®¡å“²å­¦**

### **1.1. å®ä½“ç‹¬ç«‹åŸåˆ™**

æœ¬è§„èŒƒçš„æ ¸å¿ƒæ˜¯**å®ä½“ç‹¬ç«‹**ã€‚æ¯ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼ˆç”¨æˆ·ã€é¡¹ç›®ï¼‰éƒ½ä½œä¸ºç‹¬ç«‹çš„æ–‡æ¡£å­˜åœ¨äºå…¶ä¸“å±çš„é›†åˆï¼ˆCollectionï¼‰ä¸­ã€‚è¿™å–ä»£äº†ä¹‹å‰å°†æ‰€æœ‰ä¿¡æ¯æ··æ‚åœ¨å•ä¸€æ–‡æ¡£æˆ–å¤šä¸ªåˆ†æ•£é›†åˆä¸­çš„åšæ³•ã€‚

- **`users` é›†åˆ**: å­˜å‚¨æ‰€æœ‰ä¸ç”¨æˆ·ç›¸å…³çš„å…¨å±€ä¿¡æ¯ã€‚æ¯ä¸ªæ–‡æ¡£ä»£è¡¨ä¸€ä¸ªå”¯ä¸€çš„ç”¨æˆ·ã€‚
- **`projects` é›†åˆ**: å­˜å‚¨æ‰€æœ‰ä¸é¡¹ç›®ç›¸å…³çš„ä¿¡æ¯ã€‚æ¯ä¸ªæ–‡æ¡£ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®ï¼Œå…¶å†…éƒ¨å¯åŒ…å«è¯¥é¡¹ç›®ä¸“å±çš„å­æ–‡æ¡£ï¼Œå¦‚ `issues`ã€‚

### **1.2. å…³ç³»åµŒå…¥åŸåˆ™**

å½“å®ä½“ä¹‹é—´å­˜åœ¨æ˜ç¡®çš„â€œä¸€å¯¹å¤šâ€å…³ç³»æ—¶ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªé¡¹ç›®æ‹¥æœ‰å¤šä¸ªé—®é¢˜ï¼‰ï¼Œæˆ‘ä»¬é‡‡ç”¨**åµŒå…¥**è€Œéå¼•ç”¨çš„æ–¹å¼ã€‚è¿™æ„å‘³ç€â€œå¤šâ€çš„ä¸€æ–¹ï¼ˆ`issues`ï¼‰å°†ä½œä¸ºå†…åµŒæ•°ç»„ç›´æ¥å­˜å‚¨åœ¨â€œä¸€â€çš„ä¸€æ–¹ï¼ˆ`projects` æ–‡æ¡£ï¼‰ä¸­ã€‚

**ä¼˜ç‚¹**:
- **æŸ¥è¯¢æ•ˆç‡**: ä¸€æ¬¡æŸ¥è¯¢å³å¯è·å–é¡¹ç›®åŠå…¶æ‰€æœ‰é—®é¢˜ï¼Œæ— éœ€è¿›è¡Œè·¨é›†åˆçš„ `$lookup` æ“ä½œã€‚
- **æ•°æ®ä¸€è‡´æ€§**: äº‹åŠ¡æ€§å¾—åˆ°ä¿è¯ï¼Œé¡¹ç›®å’Œå…¶é—®é¢˜ä½œä¸ºä¸€ä¸ªåŸå­å•å…ƒè¢«æ›´æ–°ã€‚
- **ä¸Šä¸‹æ–‡å®Œæ•´æ€§**: æ¯ä¸ªé¡¹ç›®éƒ½æ˜¯ä¸€ä¸ªè‡ªåŒ…å«çš„â€œçŸ¥è¯†å•å…ƒâ€ã€‚

---

## **ç¬¬äºŒç« ï¼šæ ¸å¿ƒé›†åˆç»“æ„ (Schema)**

### **2.1. `users` é›†åˆ**

å­˜å‚¨ç”¨æˆ·çš„å…¨å±€åå¥½ã€ä¿¡æ¯å’Œå­¦ä¹ å†å²ã€‚

**é›†åˆå**: `users`

**æ–‡æ¡£ç»“æ„ç¤ºä¾‹**:
```
{
  "_id": ObjectId("..."),
  "userId": "default_user", // å”¯ä¸€æ ‡è¯†ç¬¦
  "name": "å‘é˜³",
  "birthday": "1976-12-24",
  "theme": "dark", // å…¨å±€ä¸»é¢˜åå¥½
  "learningPreferences": [
    "ç»“æ„åŒ–è¾“å‡º",
    "ä»»åŠ¡é©±åŠ¨"
  ],
  "developmentWorkflowPreferences": [
    "ç¼–ç å‰å…ˆå‡º TODO List"
  ],
  "addressTerms": {
    "æ€»æŒ‡æŒ¥": "è§„åˆ’é¡¹ç›®æ—¶",
    "å¤§å¸ˆå…„": "ä¼ æˆçŸ¥è¯†æ—¶"
  },
  "goals": {
    "shortTerm": "...",
    "longTerm": "..."
  },
  "challenges": ["..."]
}
```

### **2.2. `projects` é›†åˆ**

å­˜å‚¨å…·ä½“é¡¹ç›®çš„ä¿¡æ¯ï¼Œå¹¶å†…åµŒè¯¥é¡¹ç›®ç›¸å…³çš„æ‰€æœ‰ `issues`ã€‚

**é›†åˆå**: `projects`

**æ–‡æ¡£ç»“æ„ç¤ºä¾‹**:
```
{
  "_id": ObjectId("..."),
  "projectId": "default_project", // å”¯ä¸€æ ‡è¯†ç¬¦
  "name": "Nuxt4 å®˜æ–¹ç¤ºä¾‹å­¦ä¹ ",
  "goals": {
    "shortTerm": "...",
    "longTerm": "..."
  },
  "learningMethod": "æŒ‰å®˜æ–¹ç¤ºä¾‹æ–‡æ¡£ä¸­æ¯ä¸ªç¤ºä¾‹é€ä¸€å®ç°ä¸æ¢ç´¢",
  "keyFeatures": ["..."],
  "exampleProgress": {
    "completed": [],
    "inProgress": ["001-hello-world"],
    "pending": []
  },
  "issues": [
    {
      "id": "ts-bug-001",
      "example": "typescript-implicit-any",
      "context": "ç¼–å†™ TypeScript å‡½æ•°æ—¶",
      "problem": "...",
      "solution": "...",
      "verified": true,
      "tags": ["TypeScript", "ç±»å‹å£°æ˜"],
      "lastUpdated": "2025-08-31"
    },
    {
      "id": "nuxt-gotcha-001",
      // ... å…¶ä»– issue ...
    }
  ]
}
```

---

## **ç¬¬ä¸‰ç« ï¼šCRUD æ“ä½œæŒ‡å—**

æ‰€æœ‰æ•°æ®åº“äº¤äº’**å¿…é¡»**é€šè¿‡ `mcp_MongoDB` ç³»åˆ—å·¥å…·å®Œæˆã€‚

### **3.1. ç”¨æˆ· (User) æ“ä½œ**

**åœºæ™¯ 1: æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„åå¥½**
```
# ç›®æ ‡: è·å– default_user çš„ä¸»é¢˜åå¥½
print(mcp_MongoDB_find(
    database="nuxt4",
    collection="users",
    filter={"userId": "default_user"},
    projection={"theme": 1, "_id": 0}
))
```

**åœºæ™¯ 2: æ›´æ–°ç”¨æˆ·çš„å­¦ä¹ åå¥½ (æ–°å¢)**
```
# ç›®æ ‡: ä¸º default_user æ·»åŠ ä¸€ä¸ªæ–°çš„å­¦ä¹ åå¥½ "ä»£ç ç¤ºä¾‹ä¼˜å…ˆ"
print(mcp_MongoDB_update_many(
    database="nuxt4",
    collection="users",
    filter={"userId": "default_user"},
    update={"$push": {"learningPreferences": "ä»£ç ç¤ºä¾‹ä¼˜å…ˆ"}}
))
```

**åœºæ™¯ 3: ä¿®æ”¹ç”¨æˆ·çš„ç§°å‘¼**
```
# ç›®æ ‡: å°† "å¤§å¸ˆå…„" çš„è§¦å‘æ¡ä»¶ä¿®æ”¹ä¸º "ä»»ä½•æ—¶å€™"
print(mcp_MongoDB_update_many(
    database="nuxt4",
    collection="users",
    filter={"userId": "default_user"},
    update={"$set": {"addressTerms.å¤§å¸ˆå…„": "ä»»ä½•æ—¶å€™"}}
))
```

### **3.2. é¡¹ç›®ä¸é—®é¢˜ (Project & Issue) æ“ä½œ**

**åœºæ™¯ 4: æŸ¥è¯¢å½“å‰é¡¹ç›®çš„æ‰€æœ‰å·²éªŒè¯é—®é¢˜**
```
# ç›®æ ‡: æŸ¥æ‰¾ default_project ä¸­æ‰€æœ‰ verified ä¸º true çš„ issue
print(mcp_MongoDB_aggregate(
    database="nuxt4",
    collection="projects",
    pipeline=[
        {"$match": {"projectId": "default_project"}},
        {"$unwind": "$issues"},
        {"$match": {"issues.verified": True}},
        {"$project": {"issue": "$issues", "_id": 0}}
    ]
))
```

**åœºæ™¯ 5: ä¸ºå½“å‰é¡¹ç›®æ·»åŠ ä¸€ä¸ªæ–°é—®é¢˜ (Issue)**
```
# ç›®æ ‡: å‘ default_project æ·»åŠ ä¸€ä¸ªæ–°å‘ç°çš„ issue
new_issue = {
    "id": "new-issue-001",
    "example": "some-example",
    "context": "...",
    "problem": "...",
    "solution": "...",
    "verified": False,
    "tags": ["new"],
    "lastUpdated": "..."
}
print(mcp_MongoDB_update_many(
    database="nuxt4",
    collection="projects",
    filter={"projectId": "default_project"},
    update={"$push": {"issues": new_issue}}
))
```

**åœºæ™¯ 6: æ›´æ–°ä¸€ä¸ªç°æœ‰é—®é¢˜çš„çŠ¶æ€**
```
# ç›®æ ‡: å°† default_project ä¸­ id ä¸º "ts-bug-001" çš„ issue æ ‡è®°ä¸ºæœªéªŒè¯
print(mcp_MongoDB_update_many(
    database="nuxt4",
    collection="projects",
    filter={
        "projectId": "default_project",
        "issues.id": "ts-bug-001"
    },
    update={"$set": {"issues.$.verified": False}}
))
```
**æ³¨æ„**: `issues.$.verified` ä¸­çš„ `$` æ˜¯å®šä½ç¬¦ï¼Œè¡¨ç¤ºæ›´æ–°åŒ¹é… `issues.id` çš„é‚£ä¸ªæ•°ç»„å…ƒç´ ã€‚

---

## **ç¬¬å››ç« ï¼šå†™å…¥æ“ä½œé—­ç¯**

æ‰€æœ‰å†™å…¥æ“ä½œï¼ˆ`insert`, `update`, `delete`ï¼‰**å¿…é¡»**éµå¾ªâ€œ**é¢„ä¼°-æ‰§è¡Œ-éªŒè¯**â€çš„é—­ç¯ï¼Œä»¥ç¡®ä¿æ•°æ®æ“ä½œçš„å®‰å…¨å¯æ§ã€‚

1.  **é¢„ä¼° (Predict)**: åœ¨æ‰§è¡Œæ“ä½œå‰ï¼Œæ˜ç¡®ä½ æœŸæœ›å½±å“çš„æ–‡æ¡£æ•°é‡ï¼ˆä¾‹å¦‚ï¼Œ`Matched: 1`, `Modified: 1`ï¼‰ã€‚
2.  **æ‰§è¡Œ (Execute)**: è°ƒç”¨ `mcp_MongoDB` ç³»åˆ—å·¥å…·ã€‚
3.  **éªŒè¯ (Verify)**: ä»”ç»†æ£€æŸ¥å·¥å…·è¿”å›çš„ `Matched` å’Œ `Modified` è®¡æ•°ï¼Œç¡®ä¿å®ƒä»¬ä¸ä½ çš„é¢„ä¼°å®Œå…¨ä¸€è‡´ã€‚å¦‚æœä¸ä¸€è‡´ï¼Œå¿…é¡»ç«‹å³åœæ­¢å¹¶æ’æŸ¥åŸå› ã€‚

æ­¤è§„èŒƒæ˜¯æ‰€æœ‰æ•°æ®äº¤äº’çš„æœ€é«˜å‡†åˆ™ï¼Œè¯·ä¸¥æ ¼éµå®ˆã€‚